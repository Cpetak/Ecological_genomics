head(res_clim)
res_clim[,"log2FoldChange"]
head(res_clim)
res_clim[,"padj"]
dds <- DESeqDataSetFromMatrix(countData = day10countstable, colData = conds10, design = ~ climate + treatment + climate:treatment)
dim(dds)
# Filter out genes with few reads, if we choose 76 as minimum that is on average 1 read per sample!
# this reduces the number of tests we have to from 66408 to 23887 -> have to correct less later because of the mulitple stat tests
dds <- dds[rowSums(counts(dds)) > 76]
## Set your working directory
setwd("~/Desktop/Ecological_genomics/other/Homework2")
## Import the counts matrix
countsTable <- read.table("RS_cds2kb_countsMatrix.txt", header=TRUE, row.names=1)
head(countsTable)
dim(countsTable)
countsTableRound <- round(countsTable) # Need to round because DESeq wants only integers
head(countsTableRound)
## Import the samples description table - links each sample to factors of the experimental design.
# Need the colClasses otherwise imports "day" as numeric which DESeq doesn't like, coula altneratively change to d0, d5, d10
conds <- read.delim("RS_samples.txt", header=TRUE, stringsAsFactors = TRUE, row.names=1, colClasses=c('factor', 'factor', 'factor', 'factor'))
head(conds)
dim(conds)
############ Try with only Day 10 data
day10countstable <- countsTableRound %>% select(contains("10"))
dim(day10countstable)
conds10<- subset(conds, day=="10")
dim(conds10)
head(conds10)
## Let's see how many reads we have from each sample:
colSums(day10countstable)
mean(colSums(day10countstable))
barplot(colSums(day10countstable), las=3, cex.names=0.5,names.arg = substring(colnames(day10countstable),1,13))
abline(h=mean(colSums(day10countstable)), col="blue", lwd =2)
## What is the average number of counts per gene?
rowSums(day10countstable)
mean(rowSums(day10countstable))
median(rowSums(day10countstable)) # median is much lower -> not normally distributed gene experssion, some very low/high expression
summary(apply(day10countstable,2,mean))
dds <- DESeqDataSetFromMatrix(countData = day10countstable, colData = conds10, design = ~ climate + treatment + climate:treatment)
dim(dds)
# Filter out genes with few reads, if we choose 76 as minimum that is on average 1 read per sample!
# this reduces the number of tests we have to from 66408 to 23887 -> have to correct less later because of the mulitple stat tests
dds <- dds[rowSums(counts(dds)) > 76]
dds <- DESeq(dds)
resultsNames(dds) #factors it compared, based on line where we specified design (DESeqDataSetFromMatrix). here first factor was pop. since we had day0 first, it compared day5 to it and day10 to it. see below
-------------------------------------------------------------------------------
# Order and list and summarize results from specific contrasts (i.e. the 6 above)
# Here you set your adjusted p-value cutoff, can make summary tables of the number of genes differentially expressed (up- or down-regulated) for each contrast
res <- results(dds, alpha = 0.05) #automatically gives you last comparision
res <- results(dds, alpha = 0.05)
res <- res[order(res$padj),]
summary(res) #we get, "treatment H vs C"
#to pull out results from different contrasts
res_clim <- results(dds, name ="climate_HD_vs_CW", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
head(res_clim)
-------------------------------------------------------------------------------
##### Data visualization #####
# MA plot
plotMA(res_clim, ylim=c(-3,3))
# PCA
vsd <- vst(dds, blind=FALSE)
#you can play with "nsub" operation of this function
data <- plotPCA(vsd, intgroup=c("climate", "treatment"), returnData =TRUE) #can play with ntop, default 500 genes!
percentVar <- round(100*attr(data, "percentVar"))
data$treatment <- factor(data$treatment, levels=c("C","H","D"), labels = c("C","H","D"))
data$climate <- factor(data$climate, levels=c("CW","HD"), labels = c("CW","HD"))
ggplot(data, aes(PC1, PC2, color=climate, shape=treatment)) +
geom_point(size=4, alpha=0.85) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
theme_minimal()
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_129323g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
head(res_clim)
-------------------------------------------------------------------------------
##### Data visualization #####
# MA plot
plotMA(res_clim, ylim=c(-3,3))
# PCA
vsd <- vst(dds, blind=FALSE)
#you can play with "nsub" operation of this function
data <- plotPCA(vsd, intgroup=c("climate", "treatment"), returnData =TRUE) #can play with ntop, default 500 genes!
percentVar <- round(100*attr(data, "percentVar"))
data$treatment <- factor(data$treatment, levels=c("C","H","D"), labels = c("C","H","D"))
data$climate <- factor(data$climate, levels=c("CW","HD"), labels = c("CW","HD"))
ggplot(data, aes(PC1, PC2, color=climate, shape=treatment)) +
geom_point(size=4, alpha=0.85) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
theme_minimal()
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_129323g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_D_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
-------------------------------------------------------------------------------
##### Data visualization #####
# MA plot
plotMA(res_clim, ylim=c(-3,3))
# PCA
vsd <- vst(dds, blind=FALSE)
#you can play with "nsub" operation of this function
data <- plotPCA(vsd, intgroup=c("climate", "treatment"), returnData =TRUE) #can play with ntop, default 500 genes!
percentVar <- round(100*attr(data, "percentVar"))
data$treatment <- factor(data$treatment, levels=c("C","H","D"), labels = c("C","H","D"))
data$climate <- factor(data$climate, levels=c("CW","HD"), labels = c("CW","HD"))
ggplot(data, aes(PC1, PC2, color=climate, shape=treatment)) +
geom_point(size=4, alpha=0.85) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
theme_minimal()
head(res_clim)
res_clim[,"log2FoldChange"]
head(res_clim)
res_clim[,1]
res_clim[,0]
rownames(res_clim)
head(res_clim)
res_clim[,"padj"]
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10426407g0030", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
d
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_75192g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10425837g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_824288g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10425837g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_824288g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_133272g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_71201g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_46682g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10425909g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_18818g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_77198g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Heatmap of top 20 genes sorted by pvalue
library(pheatmap)
topgenes <- head(rownames(res_clim),20) #we ordered results by pvalue alread
mat <- assay(vsd)[topgenes,]
mat <- mat - rowMeans(mat)
df <- as.data.frame(colData(dds)[,c("treatment","climate")])
pheatmap(mat, annotation_col=df)
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_H_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
head(res_clim)
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_D_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
res_clim["MA_10433227g0010",]
res_clim["MA_10243352g0010",]
res_clim["MA_10427910g0010",]
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_H_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10433227g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10243352g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10427910g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Heatmap of top 20 genes sorted by pvalue
library(pheatmap)
topgenes <- head(rownames(res_clim),20) #we ordered results by pvalue alread
mat <- assay(vsd)[topgenes,]
mat <- mat - rowMeans(mat)
df <- as.data.frame(colData(dds)[,c("treatment","climate")])
pheatmap(mat, annotation_col=df)
#to pull out results from different contrasts
res_clim <- results(dds, name ="climateHD.treatmentD", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
-------------------------------------------------------------------------------
##### Data visualization #####
# MA plot
plotMA(res_clim, ylim=c(-3,3))
#to pull out results from different contrasts
res_clim <- results(dds, name ="climateHD.treatmentH", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
-------------------------------------------------------------------------------
##### Data visualization #####
# MA plot
plotMA(res_clim, ylim=c(-3,3))
dds <- DESeqDataSetFromMatrix(countData = countsTableRound, colData = conds, design = ~ climate + treatment + day)
dim(dds)
# Filter out genes with few reads, if we choose 76 as minimum that is on average 1 read per sample!
# this reduces the number of tests we have to from 66408 to 23887 -> have to correct less later because of the mulitple stat tests
dds <- dds[rowSums(counts(dds)) > 76]
dds <- DESeq(dds)
# PCA
vsd <- vst(dds, blind=FALSE)
#you can play with "nsub" operation of this function
data <- plotPCA(vsd, intgroup=c("climate", "treatment", "day"), returnData =TRUE) #can play with ntop, default 500 genes!
percentVar <- round(100*attr(data, "percentVar"))
View(conds)
data$treatment <- factor(data$treatment, levels=c("C","H","D"), labels = c("C","H","D"))
data$climate <- factor(data$climate, levels=c("CW","HD"), labels = c("CW","HD"))
data$day <- factor(data$day, levels=c("0","5","10"), labels = c("0","5","10"))
ggplot(data, aes(PC1, PC2, color=climate, shape=treatment)) +
geom_point(size=4, alpha=0.85) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
theme_minimal()
ggplot(data, aes(PC1, PC2, color=climate, shape=day)) +
geom_point(size=4, alpha=0.85) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
theme_minimal()
ggplot(data, aes(PC1, PC2, color=treatment, shape=day)) +
geom_point(size=4, alpha=0.85) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
theme_minimal()
## What is the average number of counts per gene?
summary(rowSums(day10countstable))
dim(day10countstable)
dds <- DESeqDataSetFromMatrix(countData = day10countstable, colData = conds10, design = ~ climate + treatment + day)
# Filter out genes with few reads, if we choose 76 as minimum that is on average 1 read per sample!
# this reduces the number of tests we have to from 66408 to 23887 -> have to correct less later because of the mulitple stat tests
dds <- dds[rowSums(counts(dds)) > 76]
dds <- DESeq(dds)
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_D_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
dds <- DESeqDataSetFromMatrix(countData = day10countstable, colData = conds10, design = ~ climate + treatment + climate:treatment)
# Filter out genes with few reads, if we choose 76 as minimum that is on average 1 read per sample!
# this reduces the number of tests we have to from 66408 to 23887 -> have to correct less later because of the mulitple stat tests
dds <- dds[rowSums(counts(dds)) > 76]
dds <- DESeq(dds)
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_D_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10425837g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Heatmap of top 20 genes sorted by pvalue
library(pheatmap)
topgenes <- head(rownames(res_clim),20) #we ordered results by pvalue alread
mat <- assay(vsd)[topgenes,]
mat <- mat - rowMeans(mat)
df <- as.data.frame(colData(dds)[,c("treatment","climate")])
pheatmap(mat, annotation_col=df)
dds <- DESeqDataSetFromMatrix(countData = day10countstable, colData = conds10, design = ~ climate + treatment + climate:treatment)
# Filter out genes with few reads, if we choose 76 as minimum that is on average 1 read per sample!
# this reduces the number of tests we have to from 66408 to 23887 -> have to correct less later because of the mulitple stat tests
dds <- dds[rowSums(counts(dds)) > 76]
dds <- DESeq(dds)
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_D_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10425837g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Heatmap of top 20 genes sorted by pvalue
library(pheatmap)
topgenes <- head(rownames(res_clim),20) #we ordered results by pvalue alread
mat <- assay(vsd)[topgenes,]
mat <- mat - rowMeans(mat)
df <- as.data.frame(colData(dds)[,c("treatment","climate")])
pheatmap(mat, annotation_col=df)
dim(res_clim)
## Set your working directory
setwd("~/Desktop/Ecological_genomics/other/Homework2")
## Import the counts matrix
countsTable <- read.table("RS_cds2kb_countsMatrix.txt", header=TRUE, row.names=1)
head(countsTable)
dim(countsTable)
countsTableRound <- round(countsTable) # Need to round because DESeq wants only integers
head(countsTableRound)
## Import the samples description table - links each sample to factors of the experimental design.
# Need the colClasses otherwise imports "day" as numeric which DESeq doesn't like, coula altneratively change to d0, d5, d10
conds <- read.delim("RS_samples.txt", header=TRUE, stringsAsFactors = TRUE, row.names=1, colClasses=c('factor', 'factor', 'factor', 'factor'))
head(conds)
dim(conds)
############ Try with only Day 10 data
day10countstable <- countsTableRound %>% select(contains("10"))
dim(day10countstable)
conds10<- subset(conds, day=="10")
dim(conds10)
head(conds10)
## Let's see how many reads we have from each sample:
colSums(day10countstable)
mean(colSums(day10countstable))
barplot(colSums(day10countstable), las=3, cex.names=0.5,names.arg = substring(colnames(day10countstable),1,13))
abline(h=mean(colSums(day10countstable)), col="blue", lwd =2)
## What is the average number of counts per gene?
summary(rowSums(day10countstable))
mean(rowSums(day10countstable))
median(rowSums(day10countstable)) # median is much lower -> not normally distributed gene experssion, some very low/high expression
summary(apply(day10countstable,2,mean))
dds <- DESeqDataSetFromMatrix(countData = day10countstable, colData = conds10, design = ~ climate + treatment + climate:treatment)
dim(dds)
# Filter out genes with few reads, if we choose 76 as minimum that is on average 1 read per sample!
# this reduces the number of tests we have to from 66408 to 23887 -> have to correct less later because of the mulitple stat tests
dds <- dds[rowSums(counts(dds)) > 76]
dds <- DESeq(dds)
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_D_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
-------------------------------------------------------------------------------
##### Data visualization #####
# MA plot
plotMA(res_clim, ylim=c(-3,3))
# PCA
vsd <- vst(dds, blind=FALSE)
#you can play with "nsub" operation of this function
data <- plotPCA(vsd, intgroup=c("climate", "treatment"), returnData =TRUE) #can play with ntop, default 500 genes!
percentVar <- round(100*attr(data, "percentVar"))
data$treatment <- factor(data$treatment, levels=c("C","H","D"), labels = c("C","H","D"))
data$climate <- factor(data$climate, levels=c("CW","HD"), labels = c("CW","HD"))
ggplot(data, aes(PC1, PC2, color=climate, shape=treatment)) +
geom_point(size=4, alpha=0.85) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
theme_minimal()
# Counts of specific top gene! (important validatition that the normalization, model is working)
#look at a few top genes, if they look similar to what you expect based on model significant result, result it is not driven by one spec gene
d <-plotCounts(dds, gene="MA_10425837g0010", intgroup = (c("treatment","climate")), returnData=TRUE)
d
p <-ggplot(d, aes(x=treatment, y=count, color=climate)) +
theme_minimal() + theme(text = element_text(size=20), panel.grid.major=element_line(colour="grey"))
p <- p + geom_point(position=position_jitter(w=0.3,h=0), size=3) +
scale_x_discrete(limits=c("C","H","D"))
p
# Heatmap of top 20 genes sorted by pvalue
library(pheatmap)
topgenes <- head(rownames(res_clim),20) #we ordered results by pvalue alread
mat <- assay(vsd)[topgenes,]
mat <- mat - rowMeans(mat)
df <- as.data.frame(colData(dds)[,c("treatment","climate")])
pheatmap(mat, annotation_col=df)
# Heatmap of top 20 genes sorted by pvalue
library(pheatmap)
topgenes <- head(rownames(res_clim),20) #we ordered results by pvalue alread
mat <- assay(vsd)[topgenes,]
mat <- mat - rowMeans(mat)
df <- as.data.frame(colData(dds)[,c("treatment","climate")])
pheatmap(mat, annotation_col=df)
rownames(res_clim)
write.csv(rownames(res_clim), file="drought_genes.csv")
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_H_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
rownames(res_clim)
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_H_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
head(res_clim)
rownames(res_clim)
heat_only <- rownames(res_clim)
heat_only <- heat_only[1:6]
heat_only
drought <- read.csv(drought_genes.csv)
drought <- read.csv("drought_genes.csv")
drought
View(drought)
intersect(heat_only, drought[,"x"]
intersect(heat_only, drought[,"x"])
257+330
intersect(heat_only, drought[1:587,"x"])
#to pull out results from different contrasts
res_clim <- results(dds, name ="treatment_D_vs_C", alpha = 0.05)
res_clim <- res_clim[order(res_clim$padj),]
summary(res_clim) #we get, "treatment_D_vs_C"
res_clim["MA_10433227g0010",]
