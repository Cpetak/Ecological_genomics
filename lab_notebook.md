# My Lab Nootbook for Ecological Genomics  

## Author: Csenge Petak    

### Start Date: 2020-01-13
### End Date: 2020-05-08
### Project Descriptions:   





# Table of Contents:   
* [Entry 1: 2020-01-13, Monday](#id-section1)
* [Entry 2: 2020-01-14, Tuesday](#id-section2)
* [Entry 3: 2020-01-15, Wednesday](#id-section3)
* [Entry 4: 2020-01-16, Thursday](#id-section4)
* [Entry 5: 2020-01-17, Friday](#id-section5)
* [Entry 6: 2020-01-20, Monday](#id-section6)
* [Entry 7: 2020-01-21, Tuesday](#id-section7)
* [Entry 8: 2020-01-22, Wednesday](#id-section8)
* [Entry 9: 2020-01-23, Thursday](#id-section9)
* [Entry 10: 2020-01-24, Friday](#id-section10)
* [Entry 11: 2020-01-27, Monday](#id-section11)
* [Entry 12: 2020-01-28, Tuesday](#id-section12)
* [Entry 13: 2020-01-29, Wednesday](#id-section13)
* [Entry 14: 2020-01-30, Thursday](#id-section14)
* [Entry 15: 2020-01-31, Friday](#id-section15)
* [Entry 16: 2020-02-03, Monday](#id-section16)
* [Entry 17: 2020-02-04, Tuesday](#id-section17)
* [Entry 18: 2020-02-05, Wednesday](#id-section18)
* [Entry 19: 2020-02-06, Thursday](#id-section19)
* [Entry 20: 2020-02-07, Friday](#id-section20)
* [Entry 21: 2020-02-10, Monday](#id-section21)
* [Entry 22: 2020-02-11, Tuesday](#id-section22)
* [Entry 23: 2020-02-12, Wednesday](#id-section23)
* [Entry 24: 2020-02-13, Thursday](#id-section24)
* [Entry 25: 2020-02-14, Friday](#id-section25)
* [Entry 26: 2020-02-17, Monday](#id-section26)
* [Entry 27: 2020-02-18, Tuesday](#id-section27)
* [Entry 28: 2020-02-19, Wednesday](#id-section28)
* [Entry 29: 2020-02-20, Thursday](#id-section29)
* [Entry 30: 2020-02-21, Friday](#id-section30)
* [Entry 31: 2020-02-24, Monday](#id-section31)
* [Entry 32: 2020-02-25, Tuesday](#id-section32)
* [Entry 33: 2020-02-26, Wednesday](#id-section33)
* [Entry 34: 2020-02-27, Thursday](#id-section34)
* [Entry 35: 2020-02-28, Friday](#id-section35)
* [Entry 36: 2020-03-02, Monday](#id-section36)
* [Entry 37: 2020-03-03, Tuesday](#id-section37)
* [Entry 38: 2020-03-04, Wednesday](#id-section38)
* [Entry 39: 2020-03-05, Thursday](#id-section39)
* [Entry 40: 2020-03-06, Friday](#id-section40)
* [Entry 41: 2020-03-09, Monday](#id-section41)
* [Entry 42: 2020-03-10, Tuesday](#id-section42)
* [Entry 43: 2020-03-11, Wednesday](#id-section43)
* [Entry 44: 2020-03-12, Thursday](#id-section44)
* [Entry 45: 2020-03-13, Friday](#id-section45)
* [Entry 46: 2020-03-16, Monday](#id-section46)
* [Entry 47: 2020-03-17, Tuesday](#id-section47)
* [Entry 48: 2020-03-18, Wednesday](#id-section48)
* [Entry 49: 2020-03-19, Thursday](#id-section49)
* [Entry 50: 2020-03-20, Friday](#id-section50)
* [Entry 51: 2020-03-23, Monday](#id-section51)
* [Entry 52: 2020-03-24, Tuesday](#id-section52)
* [Entry 53: 2020-03-25, Wednesday](#id-section53)
* [Entry 54: 2020-03-26, Thursday](#id-section54)
* [Entry 55: 2020-03-27, Friday](#id-section55)
* [Entry 56: 2020-03-30, Monday](#id-section56)
* [Entry 57: 2020-03-31, Tuesday](#id-section57)
* [Entry 58: 2020-04-01, Wednesday](#id-section58)
* [Entry 59: 2020-04-02, Thursday](#id-section59)
* [Entry 60: 2020-04-03, Friday](#id-section60)
* [Entry 61: 2020-04-06, Monday](#id-section61)
* [Entry 62: 2020-04-07, Tuesday](#id-section62)
* [Entry 63: 2020-04-08, Wednesday](#id-section63)
* [Entry 64: 2020-04-09, Thursday](#id-section64)
* [Entry 65: 2020-04-10, Friday](#id-section65)
* [Entry 66: 2020-04-13, Monday](#id-section66)
* [Entry 67: 2020-04-14, Tuesday](#id-section67)
* [Entry 68: 2020-04-15, Wednesday](#id-section68)
* [Entry 69: 2020-04-16, Thursday](#id-section69)
* [Entry 70: 2020-04-17, Friday](#id-section70)
* [Entry 71: 2020-04-20, Monday](#id-section71)
* [Entry 72: 2020-04-21, Tuesday](#id-section72)
* [Entry 73: 2020-04-22, Wednesday](#id-section73)
* [Entry 74: 2020-04-23, Thursday](#id-section74)
* [Entry 75: 2020-04-24, Friday](#id-section75)
* [Entry 76: 2020-04-27, Monday](#id-section76)
* [Entry 77: 2020-04-28, Tuesday](#id-section77)
* [Entry 78: 2020-04-29, Wednesday](#id-section78)
* [Entry 79: 2020-04-30, Thursday](#id-section79)
* [Entry 80: 2020-05-01, Friday](#id-section80)
* [Entry 81: 2020-05-04, Monday](#id-section81)
* [Entry 82: 2020-05-05, Tuesday](#id-section82)
* [Entry 83: 2020-05-06, Wednesday](#id-section83)
* [Entry 84: 2020-05-07, Thursday](#id-section84)
* [Entry 85: 2020-05-08, Friday](#id-section85)


------    
<div id='id-section1'/>   


### Entry 1: 2020-01-13, Monday.   



------    
<div id='id-section2'/>   


### Entry 2: 2020-01-14, Tuesday.   



------    
<div id='id-section3'/>   


### Entry 3: 2020-01-15, Wednesday.   



------    
<div id='id-section4'/>   


### Entry 4: 2020-01-16, Thursday.   



------    
<div id='id-section5'/>   


### Entry 5: 2020-01-17, Friday.   



------    
<div id='id-section6'/>   


### Entry 6: 2020-01-20, Monday.   



------    
<div id='id-section7'/>   


### Entry 7: 2020-01-21, Tuesday.   



------    
<div id='id-section8'/>   


### Entry 8: 2020-01-22, Wednesday.   

# Intro to connecting to unix servers and navigating the bash command-line \
https://pespenilab.github.io/Ecological-Genomics/Tutorial/2020-01-22_Command_Line_Unix.html

Practice basic commands and setting up folders. \
Import metadata from /data/project_data/RS_ExomeSeq.

------    
<div id='id-section9'/>   


### Entry 9: 2020-01-23, Thursday.   



------    
<div id='id-section10'/>   


### Entry 10: 2020-01-24, Friday.   



------    
<div id='id-section11'/>   


### Entry 11: 2020-01-27, Monday.   



------    
<div id='id-section12'/>   


### Entry 12: 2020-01-28, Tuesday.   



------    
<div id='id-section13'/>   


### Entry 13: 2020-01-29, Wednesday.   

# Population Genomics Day 1 \
Pipeline on: https://pespenilab.github.io/Ecological-Genomics/2020-01-29_PopGenomics_Day1.html

cd /data/project_data/RS_ExomeSeq/fastq/edge_fastq/
R1, R2 - 1 forward, 1 reverse read for each fragment (see handwritten notes)

zcat AB_05_R1_fastq.gz | head -n 4, need this because it is gz zipped ->

### Parts of the fastq file:

First line: starts with @, which machine sequenced it, when, which spot on slide, other metadata, barcodes at the end of the line

Second line: sequence (around 150pb) , N=any base

"+" =separator

Forth line: quality of each nucleotide, asqi code, confidence score that it was read correctly, more on this on website

### Vim to edit script for fastqc operation:
write bash script for quality check in vim:\
hit i for insert mode -> file on server in my account\
hit escape  - no longer in edit mode\
shift column - command, wq = write and quite, followed by the name of the file\

not executable yet, need permission -> chmod

bash fastqc.sh -> stuff in myresults -> git add --all . -> git commit -m "message" -> git push

look at htmls of fastqc

PCR duplicates - just result of amplification, shouldn't interpret it as the actual DNA sample!

### My script to do fastqc:
``````
#!/bin/bash

cd ~/Ecological_genomics/myresults/

mkdir fastqc

for file in /data/project_data/RS_ExomeSeq/fastq/edge_fastq/XCV*fastq.gz

do

# fastqc is a program we are calling that is already available, followed by input and output location
fastqc ${file} -o fastqc/ # because I'm going to be in myresults already

done
``````

### Trimming reads:
now we'll actually make changes to the data files, not just check quality\
output to whole class\
script written for using Trimmomatic - uses both reads at the same time\

### My script for trimming reads:
``````
#!/bin/bash   
 
cd /data/project_data/RS_ExomeSeq/fastq/edge_fastq  
 
for R1 in XCV*R1_fastq.gz  

do 
 
	R2=${R1/_R1_fastq.gz/_R2_fastq.gz}
	f=${R1/_R1_fastq.gz/}
	name=`basename ${f}`

	java -classpath /data/popgen/Trimmomatic-0.33/trimmomatic-0.33.jar org.usadellab.trimmomatic.TrimmomaticPE \
        -threads 1 \
        -phred33 \
         "$R1" \
         "$R2" \
         /data/project_data/RS_ExomeSeq/fastq/edge_fastq/pairedcleanreads/${name}_R1.cl.pd.fq \
         /data/project_data/RS_ExomeSeq/fastq/edge_fastq/unpairedcleanreads/${name}_R1.cl.un.fq \
         /data/project_data/RS_ExomeSeq/fastq/edge_fastq/pairedcleanreads/${name}_R2.cl.pd.fq \
         /data/project_data/RS_ExomeSeq/fastq/edge_fastq/unpairedcleanreads/${name}_R2.cl.un.fq \
        ILLUMINACLIP:/data/popgen/Trimmomatic-0.33/adapters/TruSeq3-PE.fa:2:30:10 \
        LEADING:20 \
        TRAILING:20 \
        SLIDINGWINDOW:6:20 \
        MINLEN:35 
 
done 
``````

Meaning of settings above:

+Cut adapter and other illumina-specific sequences from the read
+Cut bases off the start of a read, if below a threshold quality = 20
+Cut bases off the end of a read, if below a threshold quality = 20
+Scan the read with a 4-base wide sliding window, cutting when the average quality per base drops below 15 (SLIDINGWINDOW:4:15) = here 6:20
+Drop the read if it is below a specified length = 35

------    
<div id='id-section14'/>   


### Entry 14: 2020-01-30, Thursday.   



------    
<div id='id-section15'/>   


### Entry 15: 2020-01-31, Friday.   



------    
<div id='id-section16'/>   


### Entry 16: 2020-02-03, Monday.   



------    
<div id='id-section17'/>   


### Entry 17: 2020-02-04, Tuesday.   



------    
<div id='id-section18'/>   


### Entry 18: 2020-02-05, Wednesday.   

# Population Genomics Day 2 \
Pipeline on: https://pespenilab.github.io/Ecological-Genomics/2020-02-05_PopGenomics_Day2.html

Last time we trimmed data -> now higher quality

Next up: **Mapping to reference** with BWA -> sam (can be looked at) -> bam (binary but better for storage)
-> remove PCR duplicates -> indexing -> mapping statistics
1st individual scripts to test -> then put it in a wrapper that calls all of them

There isn't a reference genome for this species so we are using a close relative: 20 Gb! too big -> reduced sequence based on our probes

there are only contigs, we don't know their relative location on chromosomes... like for most non-model organisms
**N50** - show state of the assembly, sort contigs based on size -> all together 668 Mb, take 50% -> length of contig at the 50% point = N50

call variable: ${myrepo}

When aligning you let some mismatches/indels

BWA = for this data a bunch of alignment algorithms were tried and this one had the best trande off between speed and accuracy
BWA-MEM = best for short sequences

-M -> allow reads to map on different contigs - those contigs could be close by on the chromosome

markdup -> removes PCR duplicates, so excess matches that map exactly the same genomic region
indexing is for quick look up and retreaval


------    
<div id='id-section19'/>   


### Entry 19: 2020-02-06, Thursday.   



------    
<div id='id-section20'/>   


### Entry 20: 2020-02-07, Friday.   



------    
<div id='id-section21'/>   


### Entry 21: 2020-02-10, Monday.   



------    
<div id='id-section22'/>   


### Entry 22: 2020-02-11, Tuesday.   



------    
<div id='id-section23'/>   


### Entry 23: 2020-02-12, Wednesday.  
# Population Genomics Day 3 \
Up to but not including "3a. Estimate the SFS for your pop" \
https://pespenilab.github.io/Ecological-Genomics/2020-02-12_PopGenomics_Day3.html

**Mapping statistics**
Output of BWA -> SAM file, includes: 
read, 
information about mapping success (orientation, left or right read), 
reference sequence name, 
mapping quality (Phred-scaled), 
CIGAR - alignment information Match (M), Insertion (I) or Deletion (D)),

-> BAM is in binary code, but same info

Summary of how well our reads mapped to the reference: 
samtools, 
-flagstat: basic info, 
-depth: depth of coverage, or how many reads cover each mapped position, on average

tview => look at a sam file, visualise (samtools tview filename)

**Discovering SNPs**
SNP calling step -> SNP 1 | Ind1 CC | Ind2 CT
but is ind1 really homozygote or there is just not enough coverage? -> using genotype likelihoods

Method: Analysis of Next Generation Sequence Data (ANGSD) 
use genotype likelihood to:
a. estimate the site frequency spectrum (SFS)
b. estimate nucleotide diversities
c. estimate Fst between all populations, or pairwise between sets of populations
d. perform a genetic PCA based on estimation of the genetic covariance matrix (this is done on the entire set of Edge ind’s)


------    
<div id='id-section24'/>   


### Entry 24: 2020-02-13, Thursday.   



------    
<div id='id-section25'/>   


### Entry 25: 2020-02-14, Friday.   



------    
<div id='id-section26'/>   


### Entry 26: 2020-02-17, Monday.   



------    
<div id='id-section27'/>   


### Entry 27: 2020-02-18, Tuesday.   



------    
<div id='id-section28'/>   


### Entry 28: 2020-02-19, Wednesday.   
# Population Genomics Day 4 \
https://pespenilab.github.io/Ecological-Genomics/2020-02-12_PopGenomics_Day4%20(1).html

**Site frequency spectrum (SFS)**
x-axis: # of individuals with derived allele (instead of anchestral), 
y-axis: # of sites
In real populations usually - lot of sites where every individual has the anchestral allele (so on x-axis 0 has high # of loci) and very few or no sites where every individuals has the derived allele (so on x-axis 2N (pop sizex2 because diploid) has low # of loci)
Example: y-axis: 200, 150, 100, 50, x-axis: 0,1,2,3 means that there are 200 sites where all individuals have the anchestral allele and there are 100 sites where 2 individuals have the derived allele.

Are we confident in the ancestral state of each variable site (SNP) in our dataset? ->
**Unfolded vs. folded SFS**

if we know the anestral state -> then the best info is contained in the unfolded spectrum
if we don't know -> make the SFS based on the minor allele (the less frequent allele; always < 0.5 in the population)

Folded spectra wraps the SFS around such that high frequency “derived” alleles are put in the small bins (low minor allele freq)

image in the tutorial: for loci where derived allele frequency more than 3 = more than 50% - they are regarded as the anchestral alleles in the folded SFS so at these loci the derived allele frequency changes from 4 to 2 (and 5 to 1 and 6 to 0) so they are going to be categorised as such -> 0,1,2 columns get taller

->> assuming the reference allele is also the ancestral allele can lead to biases in inference, and therefore the conservative thing to do is to “fold” the SFS and base it on the minor allele frequencies instead of the derived allele frequencies 
-> ‘fold 1’ flag when running the ANGSD program -> estimate the folded SFS for your pop with realSFS command

**Computing nucleotide diversities and Tajima’s D from SFS**
ANGSD again, this time we include the -pest and the doThetas flag
-> ${mypop}.thetas.idx.pestPG -> into R

Per-site values of Watterson’s theta (tW) and theta-Pi (tP): divide each statistic by the total number of sites

------    
<div id='id-section29'/>   


### Entry 29: 2020-02-20, Thursday.   



------    
<div id='id-section30'/>   


### Entry 30: 2020-02-21, Friday.   



------    
<div id='id-section31'/>   


### Entry 31: 2020-02-24, Monday.   



------    
<div id='id-section32'/>   


### Entry 32: 2020-02-25, Tuesday.   



------    
<div id='id-section33'/>   


### Entry 33: 2020-02-26, Wednesday.   
# Transcriptomics Day 1 \
https://pespenilab.github.io/Ecological-Genomics/2020-02-26_RNA-seq_Day1.html

Red scrouce 3' RNA seq = 1 read!
Factors:        Level:
Treament        - control, hot, hot and dry
Source climate  - hotdry and coldwet
Time            - 0,5,10


Possible questions to answer with this data:
Do individuals coming from different climate sources have different gene expression in each condition? 
exp ~ Source climate + treatment + (Source climate * treatment)
in different time points?
exp ~ time + Source climate + (time * Source climate) + family
What GO terms are enriched?
What genes are important?
Connecting SNPs to expression differences! ask this from melissa, look it up!

useful site: Congenie.org

**Data Processing Pipeline:**

1. FastQC on raw reads –> Trimmomatic (done!) –> FastQC on cleaned reads
2. We have reference transcriptome from closely related species:
66,632 unigenes, consisting of 26,437 high-confidence gene models, 32,150 medium-confidence gene models, and 8,045 low-confidence gene models
3. Use Salmon to simulateously map reads and quantify abundance.
4. Import the data into DESeq2 in R for data normalization, visualization, and statistical tests for differential gene expression.

My data: ASC C and D

Fastqc before and after trimming.

------    
<div id='id-section34'/>   


### Entry 34: 2020-02-27, Thursday.   



------    
<div id='id-section35'/>   


### Entry 35: 2020-02-28, Friday.   



------    
<div id='id-section36'/>   


### Entry 36: 2020-03-02, Monday.   



------    
<div id='id-section37'/>   


### Entry 37: 2020-03-03, Tuesday.   



------    
<div id='id-section38'/>   


### Entry 38: 2020-03-04, Wednesday.   



------    
<div id='id-section39'/>   


### Entry 39: 2020-03-05, Thursday.   



------    
<div id='id-section40'/>   


### Entry 40: 2020-03-06, Friday.   



------    
<div id='id-section41'/>   


### Entry 41: 2020-03-09, Monday.   



------    
<div id='id-section42'/>   


### Entry 42: 2020-03-10, Tuesday.   



------    
<div id='id-section43'/>   


### Entry 43: 2020-03-11, Wednesday.   



------    
<div id='id-section44'/>   


### Entry 44: 2020-03-12, Thursday.   



------    
<div id='id-section45'/>   


### Entry 45: 2020-03-13, Friday.   



------    
<div id='id-section46'/>   


### Entry 46: 2020-03-16, Monday.   



------    
<div id='id-section47'/>   


### Entry 47: 2020-03-17, Tuesday.   



------    
<div id='id-section48'/>   


### Entry 48: 2020-03-18, Wednesday.   



------    
<div id='id-section49'/>   


### Entry 49: 2020-03-19, Thursday.   



------    
<div id='id-section50'/>   


### Entry 50: 2020-03-20, Friday.   



------    
<div id='id-section51'/>   


### Entry 51: 2020-03-23, Monday.   



------    
<div id='id-section52'/>   


### Entry 52: 2020-03-24, Tuesday.   



------    
<div id='id-section53'/>   


### Entry 53: 2020-03-25, Wednesday.   



------    
<div id='id-section54'/>   


### Entry 54: 2020-03-26, Thursday.   



------    
<div id='id-section55'/>   


### Entry 55: 2020-03-27, Friday.   



------    
<div id='id-section56'/>   


### Entry 56: 2020-03-30, Monday.   



------    
<div id='id-section57'/>   


### Entry 57: 2020-03-31, Tuesday.   



------    
<div id='id-section58'/>   


### Entry 58: 2020-04-01, Wednesday.   



------    
<div id='id-section59'/>   


### Entry 59: 2020-04-02, Thursday.   



------    
<div id='id-section60'/>   


### Entry 60: 2020-04-03, Friday.   



------    
<div id='id-section61'/>   


### Entry 61: 2020-04-06, Monday.   



------    
<div id='id-section62'/>   


### Entry 62: 2020-04-07, Tuesday.   



------    
<div id='id-section63'/>   


### Entry 63: 2020-04-08, Wednesday.   



------    
<div id='id-section64'/>   


### Entry 64: 2020-04-09, Thursday.   



------    
<div id='id-section65'/>   


### Entry 65: 2020-04-10, Friday.   



------    
<div id='id-section66'/>   


### Entry 66: 2020-04-13, Monday.   



------    
<div id='id-section67'/>   


### Entry 67: 2020-04-14, Tuesday.   



------    
<div id='id-section68'/>   


### Entry 68: 2020-04-15, Wednesday.   



------    
<div id='id-section69'/>   


### Entry 69: 2020-04-16, Thursday.   



------    
<div id='id-section70'/>   


### Entry 70: 2020-04-17, Friday.   



------    
<div id='id-section71'/>   


### Entry 71: 2020-04-20, Monday.   



------    
<div id='id-section72'/>   


### Entry 72: 2020-04-21, Tuesday.   



------    
<div id='id-section73'/>   


### Entry 73: 2020-04-22, Wednesday.   



------    
<div id='id-section74'/>   


### Entry 74: 2020-04-23, Thursday.   



------    
<div id='id-section75'/>   


### Entry 75: 2020-04-24, Friday.   



------    
<div id='id-section76'/>   


### Entry 76: 2020-04-27, Monday.   



------    
<div id='id-section77'/>   


### Entry 77: 2020-04-28, Tuesday.   



------    
<div id='id-section78'/>   


### Entry 78: 2020-04-29, Wednesday.   



------    
<div id='id-section79'/>   


### Entry 79: 2020-04-30, Thursday.   



------    
<div id='id-section80'/>   


### Entry 80: 2020-05-01, Friday.   



------    
<div id='id-section81'/>   


### Entry 81: 2020-05-04, Monday.   



------    
<div id='id-section82'/>   


### Entry 82: 2020-05-05, Tuesday.   



------    
<div id='id-section83'/>   


### Entry 83: 2020-05-06, Wednesday.   



------    
<div id='id-section84'/>   


### Entry 84: 2020-05-07, Thursday.   



------    
<div id='id-section85'/>   


### Entry 85: 2020-05-08, Friday.   



